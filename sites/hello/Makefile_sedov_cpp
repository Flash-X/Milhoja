SHELL=/bin/sh

BASE         = sedov_cpp
MAKEFILE     = Makefile_sedov_cpp
BASEDIR      = ../..
INCDIR       = $(BASEDIR)/includes
SRCDIR       = $(BASEDIR)/src
TESTBASEDIR  = $(BASEDIR)/test/Base
SIMDIR       = $(BASEDIR)/simulations/Sedov
AMREXDIR     = $(HOME)/local/gcc_6.5.0/AMReX_2D

# Common files
CXX_HDRS   = \
    $(INCDIR)/FArray1D.h \
    $(INCDIR)/FArray2D.h \
    $(INCDIR)/FArray3D.h \
    $(INCDIR)/FArray4D.h \
    $(INCDIR)/Tile.h \
    $(INCDIR)/TileAmrex.h \
    $(INCDIR)/TileIter.h \
    $(INCDIR)/TileIterAmrex.h \
    $(INCDIR)/Grid_IntVect.h \
    $(INCDIR)/Grid_RealVect.h \
    $(INCDIR)/Grid.h \
    $(INCDIR)/GridAmrex.h \
    $(INCDIR)/Grid_AmrCoreFlash.h \
    $(INCDIR)/actionRoutine.h \
    $(INCDIR)/OrchestrationLogger.h \
    $(INCDIR)/ThreadTeamModes.h \
    $(INCDIR)/ThreadTeamDataType.h \
    $(INCDIR)/ThreadTeam.h \
    $(INCDIR)/ThreadTeamState.h \
    $(INCDIR)/ThreadTeamIdle.h \
    $(INCDIR)/ThreadTeamTerminating.h \
    $(INCDIR)/ThreadTeamRunningOpen.h \
    $(INCDIR)/ThreadTeamRunningClosed.h \
    $(INCDIR)/ThreadTeamRunningNoMoreWork.h \
    $(INCDIR)/DataItem.h \
    $(INCDIR)/RuntimeElement.h \
    $(INCDIR)/RuntimeAction.h \
    $(INCDIR)/ActionBundle.h \
    $(INCDIR)/Stream.h \
    $(INCDIR)/StreamManager.h \
    $(INCDIR)/NullStreamManager.h \
    $(INCDIR)/Runtime.h \
    $(TESTBASEDIR)/errorEstBlank.h \
    $(SIMDIR)/constants.h \
    $(SIMDIR)/Flash.h \
    $(SIMDIR)/IO.h \
    $(SIMDIR)/Eos.h \
    $(SIMDIR)/Hydro.h \
    $(SIMDIR)/Driver.h \
    $(SIMDIR)/Simulation.h \
    $(SIMDIR)/Orchestration.h
SRCS       = \
    $(SRCDIR)/RuntimeElement.cpp \
    $(SRCDIR)/ThreadTeam.cpp \
    $(SRCDIR)/ThreadTeamIdle.cpp \
    $(SRCDIR)/ThreadTeamTerminating.cpp \
    $(SRCDIR)/ThreadTeamRunningOpen.cpp \
    $(SRCDIR)/ThreadTeamRunningClosed.cpp \
    $(SRCDIR)/ThreadTeamRunningNoMoreWork.cpp \
    $(SRCDIR)/FArray1D.cpp \
    $(SRCDIR)/FArray2D.cpp \
    $(SRCDIR)/FArray3D.cpp \
    $(SRCDIR)/FArray4D.cpp \
    $(SRCDIR)/Tile.cpp \
    $(SRCDIR)/TileAmrex.cpp \
    $(SRCDIR)/Grid_IntVect.cpp \
    $(SRCDIR)/Grid_RealVect.cpp \
    $(SRCDIR)/Grid.cpp \
    $(SRCDIR)/GridAmrex.cpp \
    $(SRCDIR)/Grid_AmrCoreFlash.cpp \
    $(SRCDIR)/OrchestrationLogger.cpp \
    $(SRCDIR)/StreamManager.cpp \
    $(SRCDIR)/Runtime.cpp \
    $(TESTBASEDIR)/errorEstBlank.cpp \
    $(SIMDIR)/sim_setInitialConditions.cpp \
    $(SIMDIR)/Simulation_setInitialConditions_tile_cpu.cpp \
    $(SIMDIR)/hy_computeFluxesHll.cpp \
    $(SIMDIR)/hy_updateSolutionHll.cpp \
    $(SIMDIR)/Hydro_advanceSolution_tile_cpu.cpp \
    $(SIMDIR)/Eos_idealGamma_dens_ie.cpp \
    $(SIMDIR)/IO_data.cpp \
    $(SIMDIR)/IO_initialize.cpp \
    $(SIMDIR)/IO_finalize.cpp \
    $(SIMDIR)/IO_computeBlockIntegralQuantities.cpp \
    $(SIMDIR)/IO_computeBlockIntegralQuantities_tile_cpu.cpp \
    $(SIMDIR)/IO_computeLocalIntegralQuantities.cpp \
    $(SIMDIR)/IO_writeIntegralQuantities.cpp \
    $(SIMDIR)/Driver_data.cpp \
    $(SIMDIR)/sedov.cpp 

OBJS      = $(addsuffix .o, $(basename $(SRCS)))
COMMAND   =  $(BASE).x

CXX       = mpicxx
CXXFLAGS  = -g -O0 -std=c++11 -I$(INCDIR) -I$(TESTBASEDIR) -I$(SIMDIR) -I$(AMREXDIR)/include
CXXWARNS  =

LIBS      = -lpthread -lstdc++ -lamrex
LDFLAGS   = -L$(AMREXDIR)/lib

all:    $(COMMAND)

.SUFFIXES:
.SUFFIXES: .o .cpp

$(COMMAND): $(OBJS) $(MAKEFILE) 
	$(CXX) -o $(COMMAND) $(OBJS) $(LDFLAGS) $(LIBS)

.cpp.o: $(CXX_HDRS) $(MAKEFILE)
	$(CXX) -c $(CXXFLAGS) $(CXXWARNS) -o $@ $<

clean:
	/bin/rm -f $(COMMAND)
	/bin/rm -f *.mod
	/bin/rm -f $(SRCDIR)/*.o
	/bin/rm -f $(SIMDIR)/*.o
	/bin/rm -f $(TESTBASEDIR)/*.o

