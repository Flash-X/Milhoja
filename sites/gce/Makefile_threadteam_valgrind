SHELL=/bin/sh

# TODO: Redo this with more care.  Make certain that template .h/.cpp dependencies are correct

BASE         = test_threadteam_valgrind
MAKEFILE     = Makefile_threadteam_valgrind
BASEDIR      = ../..
INCDIR       = $(BASEDIR)/includes
SRCDIR       = $(BASEDIR)/src
TESTBASEDIR  = $(BASEDIR)/test/Base
TESTDIR      = $(BASEDIR)/test/ThreadTeamValgrind

# Common files
CXX_HDRS   = \
    $(INCDIR)/actionRoutine.h \
    $(INCDIR)/OrchestrationLogger.h \
    $(INCDIR)/ThreadTeamModes.h \
    $(INCDIR)/DataItem.h \
    $(INCDIR)/RuntimeElement.h \
    $(INCDIR)/ThreadTeam.h \
    $(INCDIR)/ThreadTeamState.h \
    $(INCDIR)/ThreadTeamIdle.h \
    $(INCDIR)/ThreadTeamTerminating.h \
    $(INCDIR)/ThreadTeamRunningOpen.h \
    $(INCDIR)/ThreadTeamRunningClosed.h \
    $(INCDIR)/ThreadTeamRunningNoMoreWork.h \
    $(INCDIR)/DataItemSplitter.h \
    $(TESTBASEDIR)/NullItem.h
SRCS       = \
    $(SRCDIR)/OrchestrationLogger.cpp \
    $(SRCDIR)/RuntimeElement.cpp \
    $(SRCDIR)/ThreadTeam.cpp \
    $(SRCDIR)/ThreadTeamIdle.cpp \
    $(SRCDIR)/ThreadTeamTerminating.cpp \
    $(SRCDIR)/ThreadTeamRunningOpen.cpp \
    $(SRCDIR)/ThreadTeamRunningClosed.cpp \
    $(SRCDIR)/ThreadTeamRunningNoMoreWork.cpp \
    $(SRCDIR)/DataItemSplitter.cpp \
    $(TESTDIR)/runThreadTeamTest.cpp

OBJS      = $(addsuffix .o, $(basename $(SRCS)))
COMMAND   =  $(BASE).x

CXX       = g++
CXXFLAGS  = -g -O0 -std=c++11 -I$(INCDIR) -I$(TESTDIR) -I$(TESTBASEDIR)
CXXWARNS  =

LIBS      = -lpthread -lstdc++
LDFLAGS   =

all:    $(COMMAND)

.SUFFIXES:
.SUFFIXES: .o .cpp

$(COMMAND): $(OBJS) $(MAKEFILE)
	$(CXX) -o $(COMMAND) $(OBJS) $(LDFLAGS) $(LIBS)

.cpp.o: $(CXX_HDRS) $(MAKEFILE)
	$(CXX) -c $(CXXFLAGS) $(CXXWARNS) -o $@ $<

clean:
	/bin/rm -f $(COMMAND)
	/bin/rm -f $(SRCDIR)/*.o
	/bin/rm -f $(TESTDIR)/*.o

