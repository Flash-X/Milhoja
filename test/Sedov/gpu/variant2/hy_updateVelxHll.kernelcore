${PROTECTIVE_PREAMBLE}

#include "Hydro.h"

#include "Flash.h"

${KERNELCORE_ROUTINE_PREFIX} ${NS_PREFIX}updateVelxHll${IMPL_SUFFIX}( $&
                                   ${ARGUMENT_SIGNATURE_buUfff}       $&
				                                    ) ${BEGIN_KERNELROUTINE}
${DUMMY_ARGUMENT_DECLS_buUfff}
${KERNELROUTINE_BOILERPLATE}

    Real    invNewDens ${INIT_LOCALVAR_GRATUITOUS_REALZERO};

${DO_FOR_INTERIOR_CELLS}
                invNewDens = 1.0_wp / Uout(i, j, k, DENS_VAR_C);

#if NDIM == 1
                Uout(i, j, k, VELX_VAR_C) = (  Uin(i,   j, k, VELX_VAR_C) * Uin(i, j, k, DENS_VAR_C)  $&
                                               + flX(i,   j, k, HY_XMOM_FLUX_C)                           $&
                                               - flX(i+1, j, k, HY_XMOM_FLUX_C) ) * invNewDens;
#elif NDIM == 2
                Uout(i, j, k, VELX_VAR_C) = (  Uin(i,   j,   k, VELX_VAR_C) * Uin(i, j, k, DENS_VAR_C)  $&
                                               + flX(i,   j,   k, HY_XMOM_FLUX_C)                           $&
                                               - flX(i+1, j,   k, HY_XMOM_FLUX_C)                           $&
                                               + flY(i,   j,   k, HY_XMOM_FLUX_C)                           $&
                                               - flY(i,   j+1, k, HY_XMOM_FLUX_C) ) * invNewDens;
#elif NDIM == 3
                Uout(i, j, k, VELX_VAR_C) = (  Uin(i,   j,   k, VELX_VAR_C) * Uin(i, j, k, DENS_VAR_C)  $&
                                               + flX(i,   j,   k,   HY_XMOM_FLUX_C)                         $&
                                               - flX(i+1, j,   k,   HY_XMOM_FLUX_C)                         $&
                                               + flY(i,   j,   k,   HY_XMOM_FLUX_C)                         $&
                                               - flY(i,   j+1, k,   HY_XMOM_FLUX_C)                         $&
                                               + flZ(i,   j,   k,   HY_XMOM_FLUX_C)                         ${&}
                                               - flZ(i,   j,   k+1, HY_XMOM_FLUX_C) ) * invNewDens;
#endif
${END_DO_FOR_INTERIOR_CELLS}
${END_KERNELROUTINE}

